# Join

Takes the generated data record as an argument and returns the value corresponding to the value of the key field from the dictionary or lookup.

## Implementation by builder

Describes how to define fields using DataGeneratorBuilder.

### Sample code

```c#
// Creates a builder.
DataGeneratorBuilder builder = new DataGeneratorBuilder();

// Adds fields.
builder
    .AddField(factory => factory.Each(
      "ID",
      new int?[] { 1, 2, 3, null }
      ))
    .AddField(factory => factory.Each(
      "Area",
      new char?[] { 'A', 'B' }
      ))

    // Add fields that return the value corresponding to "ID".
    .AddJoinField(factory => factory.WithDictionary(
      // Specifies the name of the key field.
      "ID",
      // Specifies the names of the fields to be added.
      new[] { "Name", "CreateAt" },
      // Specifies the dictionary that stores the value to add.
      new Dictionary<int, (StringValue, DateTime)>()
      {
          { 1, ("A", new DateTime(2021, 1, 1)) },
          { 3, ("C", new DateTime(2021, 3, 1)) },
          { 5, ("E", new DateTime(2021, 5, 1)) }
      }
      ))

    // Add fields that return the value corresponding to "ID" and "Area".
    .AddJoinField(factory => factory.WithDictionaryKey2(
      // Specifies the name of the key field.
      new[] { "ID", "Area" },
      // Specifies the names of the fields to be added.
      "Amount",
      // Specifies the dictionary that stores the value to add.
      new Dictionary<(int, char), int>()
      {
        { (1, 'A'), 100 },
        { (1, 'B'), 200 },
        { (3, 'C'), 300 }
      }
      ))
    ;

// Creates a generator that generates 10 records and returns it as a DataReader.
using IDataReader reader = await builder.BuildAsDataReaderAsync(10);
```

The IDataReader generated by this sample code will generate the following data:

```console
ID      Area    Name	  CreateAt    Amount
------- ------- ------- ----------- -------
1       A       A       2021/01/01  100
2       B       (null)  (null)      (null)
3       A       C       2021/03/01  300
(null)  B       (null)  (null)      (null)
1       A       A       2021/01/01  100
2       B       (null)  (null)      (null)
3       A       C       2021/03/01  300
(null)  B       (null)  (null)      (null)
1       A       A       2021/01/01  100
2       B       (null)  (null)      (null)
```


## Implementation by configuration

Describes how to use a configuration class to define the same fields as the sample code above.

### Sample code

```c#
// Creates a generator settings.
DataGeneratorSettings generatorSetting = new DataGeneratorSettings();

generatorSetting.Fields = new DataGeneratorFieldSettings[]
{
  new EachFieldSettings<int>()
  {
    FieldName = "ID",
    Values = new int?[]{ 1, 2, 3, null },
  }
  new EachFieldSettings<char>()
  {
    FieldName = "Area",
    Values = new char?[]{ 'A', 'B' },
  }
};

generatorSetting.AdditionalTupleFields = new DataGeneratorAdditionalTupleFieldSettings[]
{
  // Add fields that return the value corresponding to "ID".
  new JoinFieldSettings()
  {
    // Specifies the key field.
    KeyFields = new[]
    {
      new DataGeneratorFieldInfo("ID", typeof(int))
    },
    // Specifies the fields to be added.
    AdditionalFields = new[]
    {
      new DataGeneratorFieldInfo("Name", typeof(string)),
      new DataGeneratorFieldInfo("CreateAt", typeof(DateTime))
    },
    // Specifies the dictionary that stores the value to add.
    AdditionalValues = new Dictionary<string?[], string?[]>()
    {
      {
        new[]{ "1" },
        new[]{ "A", "2021/01/01" }
      },
      {
        new[]{ "3" },
        new[]{ "C", "2021/03/01" }
      },
      {
        new[]{ "5" },
        new[]{ "E", "2021/05/01" }
      }
    }
  },
  // Add fields that return the value corresponding to "ID" and "Area".
  new JoinFieldSettings()
  {
    // Specifies the key fields.
    KeyFields = new[]
    {
      new DataGeneratorFieldInfo("ID", typeof(int)),
      new DataGeneratorFieldInfo("Area", typeof(char))
    },
    // Specifies the field to be added.
    AdditionalFields = new[]
    {
      new DataGeneratorFieldInfo("Amount", typeof(int)),
    },
    // Specifies the dictionary that stores the value to add.
    AdditionalValues = new Dictionary<string?[], string?[]>()
    {
      {
        new[]{ "1", "A" },
        new[]{ "100" }
      },
      {
        new[]{ "1", "B" },
        new[]{ "200" }
      },
      {
        new[]{ "3", "A" },
        new[]{ "300" }
      }
    }
  }
};

// Create a context that controls the behavior of the generator.
// You can replace random number generation algorithms, string converters, etc. with your own implementation.
DataGeneratorContext context = new DataGeneratorContext();

// Creates a builder.
DataGeneratorBuilder builder = generatorSetting.CreateBuilder(context);

// Creates a generator that generates 10 records and returns it as a DataReader.
using IDataReader reader = await builder.BuildAsDataReaderAsync(10);
```


### Json serialization

The DataGeneratorSettings instance in the sample code above is serialized into a JSON string like this:

```json
{
  "Fields": [
    {
      "Name": "ID",
      "NullProb": 0.0,
      "Values": [
        1,
        2,
        3,
        null
      ],
      "FieldType": "EachInt32"
    },
    {
      "Name": "Area",
      "NullProb": 0.0,
      "Values": [
        "A",
        "B"
      ],
      "FieldType": "EachChar"
    }
  ],
  "TupleFields": null,
  "AdditionalFields": null,
  "AdditionalTupleFields": [
    {
      "AdditionalFields": [
        {
          "FieldName": "Name",
          "ValueType": "System.String"
        },
        {
          "FieldName": "CreateAt",
          "ValueType": "System.DateTime"
        }
      ],
      "KeyFields": [
        {
          "FieldName": "ID",
          "ValueType": "System.Int32"
        }
      ],
      "AdditionalValues": [
        {
          "Key": [
            "1"
          ],
          "Value": [
            "A",
            "2021/01/01"
          ]
        },
        {
          "Key": [
            "3"
          ],
          "Value": [
            "C",
            "2021/03/01"
          ]
        },
        {
          "Key": [
            "5"
          ],
          "Value": [
            "E",
            "2021/05/01"
          ]
        }
      ],
      "FieldType": "Join"
    },
    {
      "AdditionalFields": [
        {
          "FieldName": "Amount",
          "ValueType": "System.Int32"
        }
      ],
      "KeyFields": [
        {
          "FieldName": "ID",
          "ValueType": "System.Int32"
        },
        {
          "FieldName": "Area",
          "ValueType": "System.Char"
        }
      ],
      "AdditionalValues": [
        {
          "Key": [
            "1",
            "A"
          ],
          "Value": [
            "100"
          ]
        },
        {
          "Key": [
            "1",
            "B"
          ],
          "Value": [
            "200"
          ]
        },
        {
          "Key": [
            "3",
            "A"
          ],
          "Value": [
            "300"
          ]
        }
      ],
      "FieldType": "Join"
    }
  ]
}
```

